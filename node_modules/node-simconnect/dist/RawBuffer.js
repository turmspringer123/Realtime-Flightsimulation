"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RawBuffer = void 0;
const ByteBuffer = require("bytebuffer");
class RawBuffer {
    constructor(b) {
        if (typeof b === 'number') {
            this.buffer = ByteBuffer.allocate(b).LE(true);
        }
        else {
            this.buffer = ByteBuffer.wrap(b).LE(true);
        }
    }
    clear() {
        this.buffer.clear();
    }
    setOffset(offset) {
        this.buffer.offset = offset;
    }
    flip() {
        this.buffer.flip();
    }
    getOffset() {
        return this.buffer.offset;
    }
    getBuffer() {
        this.buffer.flip();
        return this.buffer.toBuffer(true);
    }
    write(bytes) {
        this.buffer.append(bytes);
    }
    writeByte(byte) {
        this.buffer.writeByte(byte);
    }
    readBytes(length) {
        const bytes = this.buffer.readBytes(length).copy();
        return bytes.toBuffer();
    }
    readInt() {
        return this.buffer.readInt32();
    }
    writeInt(value, offset) {
        this.buffer.writeInt32(value, offset);
    }
    readLong() {
        return this.buffer.readInt64().toNumber();
    }
    writeLong(value) {
        this.buffer.writeInt64(value);
    }
    readFloat() {
        return this.buffer.readFloat32();
    }
    writeFloat(value) {
        this.buffer.writeFloat32(value);
    }
    readDouble() {
        return this.buffer.readFloat64();
    }
    writeDouble(value) {
        this.buffer.writeFloat64(value);
    }
    writeString(value, fixedLength) {
        putString(this.buffer, value, fixedLength || value.length);
    }
    readString8() {
        return makeString(this.buffer, 8);
    }
    writeString8(value) {
        putString(this.buffer, value, 8);
    }
    writeString30(value) {
        putString(this.buffer, value, 30);
    }
    readString32() {
        return makeString(this.buffer, 32);
    }
    writeString32(value) {
        putString(this.buffer, value, 32);
    }
    readString64() {
        return makeString(this.buffer, 64);
    }
    writeString64(value) {
        putString(this.buffer, value, 64);
    }
    readString128() {
        return makeString(this.buffer, 128);
    }
    writeString128(value) {
        putString(this.buffer, value, 128);
    }
    readString256() {
        return makeString(this.buffer, 256);
    }
    writeString256(value) {
        putString(this.buffer, value, 256);
    }
    readString260() {
        return makeString(this.buffer, 260);
    }
    writeString260(value) {
        putString(this.buffer, value, 260);
    }
    readStringV() {
        let bytesRead = 0;
        let strLen = 0;
        let endFound = false;
        while (this.buffer.offset < this.buffer.limit) {
            const currentByte = this.buffer.readByte();
            bytesRead++;
            if (endFound && currentByte !== 0) {
                break; // Reached beginning of new value
            }
            else if (currentByte === 0) {
                endFound = true;
            }
            strLen++;
        }
        // Reset offset so we can read the same bytes later
        this.buffer.offset -= bytesRead;
        return makeString(this.buffer, strLen);
    }
    readString(length) {
        return makeString(this.buffer, length);
    }
    remaining() {
        return this.buffer.remaining();
    }
}
exports.RawBuffer = RawBuffer;
function makeString(bf, expectedLength) {
    const content = bf.readCString(bf.offset);
    bf.skip(expectedLength);
    return content.string;
}
function putString(bf, s, fixed) {
    const value = s === null ? '' : s;
    const bytes = Buffer.from(value, 'utf-8');
    bf.append(bytes);
    if (bytes.length < fixed) {
        for (let i = 0; i < fixed - bytes.length; i++) {
            bf.writeByte(0x00);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmF3QnVmZmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1Jhd0J1ZmZlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSx5Q0FBMEM7QUFFMUMsTUFBTSxTQUFTO0lBR1gsWUFBWSxDQUFrQjtRQUMxQixJQUFJLE9BQU8sQ0FBQyxLQUFLLFFBQVEsRUFBRTtZQUN2QixJQUFJLENBQUMsTUFBTSxHQUFHLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2pEO2FBQU07WUFDSCxJQUFJLENBQUMsTUFBTSxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzdDO0lBQ0wsQ0FBQztJQUVELEtBQUs7UUFDRCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFFRCxTQUFTLENBQUMsTUFBYztRQUNwQixJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7SUFDaEMsQ0FBQztJQUVELElBQUk7UUFDQSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxTQUFTO1FBQ0wsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQztJQUM5QixDQUFDO0lBRUQsU0FBUztRQUNMLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDbkIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRUQsS0FBSyxDQUFDLEtBQWE7UUFDZixJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBRUQsU0FBUyxDQUFDLElBQVk7UUFDbEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDaEMsQ0FBQztJQUVELFNBQVMsQ0FBQyxNQUFjO1FBQ3BCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ25ELE9BQU8sS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzVCLENBQUM7SUFFRCxPQUFPO1FBQ0gsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ25DLENBQUM7SUFFRCxRQUFRLENBQUMsS0FBYSxFQUFFLE1BQWU7UUFDbkMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzFDLENBQUM7SUFFRCxRQUFRO1FBQ0osT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzlDLENBQUM7SUFFRCxTQUFTLENBQUMsS0FBYTtRQUNuQixJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBRUQsU0FBUztRQUNMLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUNyQyxDQUFDO0lBRUQsVUFBVSxDQUFDLEtBQWE7UUFDcEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDcEMsQ0FBQztJQUVELFVBQVU7UUFDTixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDckMsQ0FBQztJQUVELFdBQVcsQ0FBQyxLQUFhO1FBQ3JCLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFFRCxXQUFXLENBQUMsS0FBYSxFQUFFLFdBQW9CO1FBQzNDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxXQUFXLElBQUksS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQy9ELENBQUM7SUFFRCxXQUFXO1FBQ1AsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRUQsWUFBWSxDQUFDLEtBQWE7UUFDdEIsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFRCxhQUFhLENBQUMsS0FBYTtRQUN2QixTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVELFlBQVk7UUFDUixPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxhQUFhLENBQUMsS0FBYTtRQUN2QixTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVELFlBQVk7UUFDUixPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxhQUFhLENBQUMsS0FBYTtRQUN2QixTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVELGFBQWE7UUFDVCxPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUFFRCxjQUFjLENBQUMsS0FBYTtRQUN4QixTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVELGFBQWE7UUFDVCxPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUFFRCxjQUFjLENBQUMsS0FBb0I7UUFDL0IsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxhQUFhO1FBQ1QsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRUQsY0FBYyxDQUFDLEtBQWE7UUFDeEIsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxXQUFXO1FBQ1AsSUFBSSxTQUFTLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLElBQUksTUFBTSxHQUFHLENBQUMsQ0FBQztRQUNmLElBQUksUUFBUSxHQUFHLEtBQUssQ0FBQztRQUNyQixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFO1lBQzNDLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDM0MsU0FBUyxFQUFFLENBQUM7WUFDWixJQUFJLFFBQVEsSUFBSSxXQUFXLEtBQUssQ0FBQyxFQUFFO2dCQUMvQixNQUFNLENBQUMsaUNBQWlDO2FBQzNDO2lCQUFNLElBQUksV0FBVyxLQUFLLENBQUMsRUFBRTtnQkFDMUIsUUFBUSxHQUFHLElBQUksQ0FBQzthQUNuQjtZQUNELE1BQU0sRUFBRSxDQUFDO1NBQ1o7UUFDRCxtREFBbUQ7UUFDbkQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLElBQUksU0FBUyxDQUFDO1FBQ2hDLE9BQU8sVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDM0MsQ0FBQztJQUVELFVBQVUsQ0FBQyxNQUFjO1FBQ3JCLE9BQU8sVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDM0MsQ0FBQztJQUVELFNBQVM7UUFDTCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDbkMsQ0FBQztDQUNKO0FBbUJRLDhCQUFTO0FBakJsQixTQUFTLFVBQVUsQ0FBQyxFQUFjLEVBQUUsY0FBc0I7SUFDdEQsTUFBTSxPQUFPLEdBQUcsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDMUMsRUFBRSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUN4QixPQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUM7QUFDMUIsQ0FBQztBQUVELFNBQVMsU0FBUyxDQUFDLEVBQWMsRUFBRSxDQUFnQixFQUFFLEtBQWE7SUFDOUQsTUFBTSxLQUFLLEdBQUcsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbEMsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDMUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNqQixJQUFJLEtBQUssQ0FBQyxNQUFNLEdBQUcsS0FBSyxFQUFFO1FBQ3RCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUMzQyxFQUFFLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3RCO0tBQ0o7QUFDTCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJ5dGVCdWZmZXIgPSByZXF1aXJlKCdieXRlYnVmZmVyJyk7XG5cbmNsYXNzIFJhd0J1ZmZlciB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBidWZmZXI6IEJ5dGVCdWZmZXI7XG5cbiAgICBjb25zdHJ1Y3RvcihiOiBCdWZmZXIgfCBudW1iZXIpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBiID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgdGhpcy5idWZmZXIgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKGIpLkxFKHRydWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5idWZmZXIgPSBCeXRlQnVmZmVyLndyYXAoYikuTEUodHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjbGVhcigpIHtcbiAgICAgICAgdGhpcy5idWZmZXIuY2xlYXIoKTtcbiAgICB9XG5cbiAgICBzZXRPZmZzZXQob2Zmc2V0OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5idWZmZXIub2Zmc2V0ID0gb2Zmc2V0O1xuICAgIH1cblxuICAgIGZsaXAoKSB7XG4gICAgICAgIHRoaXMuYnVmZmVyLmZsaXAoKTtcbiAgICB9XG5cbiAgICBnZXRPZmZzZXQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLm9mZnNldDtcbiAgICB9XG5cbiAgICBnZXRCdWZmZXIoKTogQnVmZmVyIHtcbiAgICAgICAgdGhpcy5idWZmZXIuZmxpcCgpO1xuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIudG9CdWZmZXIodHJ1ZSk7XG4gICAgfVxuXG4gICAgd3JpdGUoYnl0ZXM6IEJ1ZmZlcikge1xuICAgICAgICB0aGlzLmJ1ZmZlci5hcHBlbmQoYnl0ZXMpO1xuICAgIH1cblxuICAgIHdyaXRlQnl0ZShieXRlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5idWZmZXIud3JpdGVCeXRlKGJ5dGUpO1xuICAgIH1cblxuICAgIHJlYWRCeXRlcyhsZW5ndGg6IG51bWJlcik6IEJ1ZmZlciB7XG4gICAgICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5idWZmZXIucmVhZEJ5dGVzKGxlbmd0aCkuY29weSgpO1xuICAgICAgICByZXR1cm4gYnl0ZXMudG9CdWZmZXIoKTtcbiAgICB9XG5cbiAgICByZWFkSW50KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlci5yZWFkSW50MzIoKTtcbiAgICB9XG5cbiAgICB3cml0ZUludCh2YWx1ZTogbnVtYmVyLCBvZmZzZXQ/OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5idWZmZXIud3JpdGVJbnQzMih2YWx1ZSwgb2Zmc2V0KTtcbiAgICB9XG5cbiAgICByZWFkTG9uZygpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIucmVhZEludDY0KCkudG9OdW1iZXIoKTtcbiAgICB9XG5cbiAgICB3cml0ZUxvbmcodmFsdWU6IG51bWJlcikge1xuICAgICAgICB0aGlzLmJ1ZmZlci53cml0ZUludDY0KHZhbHVlKTtcbiAgICB9XG5cbiAgICByZWFkRmxvYXQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLnJlYWRGbG9hdDMyKCk7XG4gICAgfVxuXG4gICAgd3JpdGVGbG9hdCh2YWx1ZTogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuYnVmZmVyLndyaXRlRmxvYXQzMih2YWx1ZSk7XG4gICAgfVxuXG4gICAgcmVhZERvdWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLnJlYWRGbG9hdDY0KCk7XG4gICAgfVxuXG4gICAgd3JpdGVEb3VibGUodmFsdWU6IG51bWJlcikge1xuICAgICAgICB0aGlzLmJ1ZmZlci53cml0ZUZsb2F0NjQodmFsdWUpO1xuICAgIH1cblxuICAgIHdyaXRlU3RyaW5nKHZhbHVlOiBzdHJpbmcsIGZpeGVkTGVuZ3RoPzogbnVtYmVyKSB7XG4gICAgICAgIHB1dFN0cmluZyh0aGlzLmJ1ZmZlciwgdmFsdWUsIGZpeGVkTGVuZ3RoIHx8IHZhbHVlLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgcmVhZFN0cmluZzgoKSB7XG4gICAgICAgIHJldHVybiBtYWtlU3RyaW5nKHRoaXMuYnVmZmVyLCA4KTtcbiAgICB9XG5cbiAgICB3cml0ZVN0cmluZzgodmFsdWU6IHN0cmluZykge1xuICAgICAgICBwdXRTdHJpbmcodGhpcy5idWZmZXIsIHZhbHVlLCA4KTtcbiAgICB9XG5cbiAgICB3cml0ZVN0cmluZzMwKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgcHV0U3RyaW5nKHRoaXMuYnVmZmVyLCB2YWx1ZSwgMzApO1xuICAgIH1cblxuICAgIHJlYWRTdHJpbmczMigpIHtcbiAgICAgICAgcmV0dXJuIG1ha2VTdHJpbmcodGhpcy5idWZmZXIsIDMyKTtcbiAgICB9XG5cbiAgICB3cml0ZVN0cmluZzMyKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgcHV0U3RyaW5nKHRoaXMuYnVmZmVyLCB2YWx1ZSwgMzIpO1xuICAgIH1cblxuICAgIHJlYWRTdHJpbmc2NCgpIHtcbiAgICAgICAgcmV0dXJuIG1ha2VTdHJpbmcodGhpcy5idWZmZXIsIDY0KTtcbiAgICB9XG5cbiAgICB3cml0ZVN0cmluZzY0KHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgcHV0U3RyaW5nKHRoaXMuYnVmZmVyLCB2YWx1ZSwgNjQpO1xuICAgIH1cblxuICAgIHJlYWRTdHJpbmcxMjgoKSB7XG4gICAgICAgIHJldHVybiBtYWtlU3RyaW5nKHRoaXMuYnVmZmVyLCAxMjgpO1xuICAgIH1cblxuICAgIHdyaXRlU3RyaW5nMTI4KHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgcHV0U3RyaW5nKHRoaXMuYnVmZmVyLCB2YWx1ZSwgMTI4KTtcbiAgICB9XG5cbiAgICByZWFkU3RyaW5nMjU2KCkge1xuICAgICAgICByZXR1cm4gbWFrZVN0cmluZyh0aGlzLmJ1ZmZlciwgMjU2KTtcbiAgICB9XG5cbiAgICB3cml0ZVN0cmluZzI1Nih2YWx1ZTogc3RyaW5nIHwgbnVsbCkge1xuICAgICAgICBwdXRTdHJpbmcodGhpcy5idWZmZXIsIHZhbHVlLCAyNTYpO1xuICAgIH1cblxuICAgIHJlYWRTdHJpbmcyNjAoKSB7XG4gICAgICAgIHJldHVybiBtYWtlU3RyaW5nKHRoaXMuYnVmZmVyLCAyNjApO1xuICAgIH1cblxuICAgIHdyaXRlU3RyaW5nMjYwKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgcHV0U3RyaW5nKHRoaXMuYnVmZmVyLCB2YWx1ZSwgMjYwKTtcbiAgICB9XG5cbiAgICByZWFkU3RyaW5nVigpIHtcbiAgICAgICAgbGV0IGJ5dGVzUmVhZCA9IDA7XG4gICAgICAgIGxldCBzdHJMZW4gPSAwO1xuICAgICAgICBsZXQgZW5kRm91bmQgPSBmYWxzZTtcbiAgICAgICAgd2hpbGUgKHRoaXMuYnVmZmVyLm9mZnNldCA8IHRoaXMuYnVmZmVyLmxpbWl0KSB7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50Qnl0ZSA9IHRoaXMuYnVmZmVyLnJlYWRCeXRlKCk7XG4gICAgICAgICAgICBieXRlc1JlYWQrKztcbiAgICAgICAgICAgIGlmIChlbmRGb3VuZCAmJiBjdXJyZW50Qnl0ZSAhPT0gMCkge1xuICAgICAgICAgICAgICAgIGJyZWFrOyAvLyBSZWFjaGVkIGJlZ2lubmluZyBvZiBuZXcgdmFsdWVcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY3VycmVudEJ5dGUgPT09IDApIHtcbiAgICAgICAgICAgICAgICBlbmRGb3VuZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzdHJMZW4rKztcbiAgICAgICAgfVxuICAgICAgICAvLyBSZXNldCBvZmZzZXQgc28gd2UgY2FuIHJlYWQgdGhlIHNhbWUgYnl0ZXMgbGF0ZXJcbiAgICAgICAgdGhpcy5idWZmZXIub2Zmc2V0IC09IGJ5dGVzUmVhZDtcbiAgICAgICAgcmV0dXJuIG1ha2VTdHJpbmcodGhpcy5idWZmZXIsIHN0ckxlbik7XG4gICAgfVxuXG4gICAgcmVhZFN0cmluZyhsZW5ndGg6IG51bWJlcikge1xuICAgICAgICByZXR1cm4gbWFrZVN0cmluZyh0aGlzLmJ1ZmZlciwgbGVuZ3RoKTtcbiAgICB9XG5cbiAgICByZW1haW5pbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlci5yZW1haW5pbmcoKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIG1ha2VTdHJpbmcoYmY6IEJ5dGVCdWZmZXIsIGV4cGVjdGVkTGVuZ3RoOiBudW1iZXIpIHtcbiAgICBjb25zdCBjb250ZW50ID0gYmYucmVhZENTdHJpbmcoYmYub2Zmc2V0KTtcbiAgICBiZi5za2lwKGV4cGVjdGVkTGVuZ3RoKTtcbiAgICByZXR1cm4gY29udGVudC5zdHJpbmc7XG59XG5cbmZ1bmN0aW9uIHB1dFN0cmluZyhiZjogQnl0ZUJ1ZmZlciwgczogc3RyaW5nIHwgbnVsbCwgZml4ZWQ6IG51bWJlcikge1xuICAgIGNvbnN0IHZhbHVlID0gcyA9PT0gbnVsbCA/ICcnIDogcztcbiAgICBjb25zdCBieXRlcyA9IEJ1ZmZlci5mcm9tKHZhbHVlLCAndXRmLTgnKTtcbiAgICBiZi5hcHBlbmQoYnl0ZXMpO1xuICAgIGlmIChieXRlcy5sZW5ndGggPCBmaXhlZCkge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpeGVkIC0gYnl0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGJmLndyaXRlQnl0ZSgweDAwKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IHsgUmF3QnVmZmVyIH07XG4iXX0=